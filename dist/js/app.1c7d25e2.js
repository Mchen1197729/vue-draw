(function(e){function t(t){for(var a,r,o=t[0],l=t[1],h=t[2],d=0,u=[];d<o.length;d++)r=o[d],Object.prototype.hasOwnProperty.call(n,r)&&n[r]&&u.push(n[r][0]),n[r]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);c&&c(t);while(u.length)u.shift()();return s.push.apply(s,h||[]),i()}function i(){for(var e,t=0;t<s.length;t++){for(var i=s[t],a=!0,o=1;o<i.length;o++){var l=i[o];0!==n[l]&&(a=!1)}a&&(s.splice(t--,1),e=r(r.s=i[0]))}return e}var a={},n={app:0},s=[];function r(t){if(a[t])return a[t].exports;var i=a[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=a,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(i,a,function(t){return e[t]}.bind(null,a));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var h=0;h<o.length;h++)t(o[h]);var c=l;s.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("56d7")},2395:function(e,t,i){},"56d7":function(e,t,i){"use strict";i.r(t);i("e260"),i("e6cf"),i("cca6"),i("a79d");var a=i("2b0e"),n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"container"},[i("div",{staticClass:"header-container"},[i("div",{staticClass:"down-box"},[i("el-button",{attrs:{size:"small"},on:{click:e.handleOpenFile}},[e._v("打开文件")]),i("el-button",{attrs:{size:"small"},on:{click:e.handleSaveFile}},[e._v("保存文件")]),i("div",{staticClass:"color-box"},[i("span",{staticClass:"title"},[e._v("颜色")]),i("el-color-picker",{attrs:{size:"small"},on:{change:e.handleChooseColor},model:{value:e.shapeColor,callback:function(t){e.shapeColor=t},expression:"shapeColor"}})],1),i("div",{staticClass:"line-width-box"},[i("span",{staticClass:"title"},[e._v("线宽")]),i("el-input-number",{attrs:{size:"small","controls-position":"right",min:1,max:10},on:{change:e.handleChooseLineWidth},model:{value:e.shapeLineWidth,callback:function(t){e.shapeLineWidth=t},expression:"shapeLineWidth"}})],1),i("el-popconfirm",{attrs:{title:"确定要清空画布吗？"},on:{confirm:e.handleClearMap}},[i("el-button",{staticStyle:{"margin-right":"10px"},attrs:{slot:"reference",type:"danger",plain:"",size:"small"},slot:"reference"},[e._v("清空画布")])],1),i("el-button",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{size:"small"},on:{click:e.handleTest}},[e._v("测试")])],1)]),i("div",{staticClass:"main-section"},[i("div",{staticClass:"tool-container"},[i("div",{staticClass:"tool-tabs-box"},[i("div",{staticClass:"title-box"},[i("div",{staticClass:"item source-title",class:{current:0===e.currentTabIndex},on:{click:e.handleShowSource}},[e._v("图元库")]),i("div",{staticClass:"item source-manage",class:{current:1===e.currentTabIndex},on:{click:e.handleManageSource}},[e._v("图元管理 ")]),i("div",{staticClass:"item create-btn",on:{click:e.handleCreateImageSource}},[e._v("创建图元")])]),i("div",{staticClass:"content-box"},[i("div",{directives:[{name:"show",rawName:"v-show",value:0===e.currentTabIndex,expression:"currentTabIndex===0"}],staticClass:"image-sources-box"},e._l(e.imageSources,(function(t){return i("div",{key:t.name,staticClass:"images-source-item",on:{click:function(i){return e.handleAddImage(t)}}},[i("img",{attrs:{src:t.url,alt:""}}),i("span",[e._v(e._s(t.name))])])})),0),i("div",{directives:[{name:"show",rawName:"v-show",value:1===e.currentTabIndex,expression:"currentTabIndex===1"}],staticClass:"image-sources-manage-box"},e._l(e.imageSources,(function(t){return i("div",{key:t.name,staticClass:"image-source-item"},[i("img",{attrs:{src:t.url,alt:""}}),i("span",{staticClass:"name"},[e._v(e._s(t.name))]),i("div",{staticClass:"operations"},[i("el-popconfirm",{attrs:{title:"确定删除该图元吗？"},on:{confirm:function(i){return e.handleDelSource(t)}}},[i("span",{staticClass:"delete",attrs:{slot:"reference"},slot:"reference"},[e._v("删除")])]),i("span",{staticClass:"update",on:{click:function(i){return e.handleUpdateSource(t)}}},[e._v("修改")])],1)])})),0)])]),i("div",{staticClass:"shape-source-box"},e._l(e.shapeArr,(function(t,a){return i("div",{key:a,staticClass:"shape-box"},e._l(t,(function(t,a){return i("div",{key:a,staticClass:"shape-item",class:{current:t.index===e.shapeIndex},on:{click:function(i){return e.handleChooseShape(t.index)}}},[e._v(e._s(t.shapeName)+" ")])})),0)})),0)]),i("div",{staticClass:"draw-container",on:{mousedown:e.handleMouseDown,mousemove:e.handleMousemove,mouseup:e.handleMouseup}})]),i("a",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"downloadLink",attrs:{href:""}}),i("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"uploadLink",attrs:{type:"file"},on:{change:e.handleFileChange}}),i("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"imageLink",attrs:{type:"file"},on:{change:e.handleChooseImage}}),i("el-dialog",{attrs:{width:"30%",title:e.dialogTitle,visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[i("el-form",{attrs:{size:"small",rules:e.rules,model:e.form}},[i("el-form-item",{attrs:{label:"图元名称","label-width":"100px",prop:"name"}},[i("el-input",{staticStyle:{width:"140px"},attrs:{autocomplete:"off"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),i("el-form-item",{attrs:{label:"图元图片","label-width":"100px"}},[i("div",{staticClass:"avatar-uploader"},[e.form.url?i("img",{staticClass:"avatar",attrs:{src:e.form.url},on:{click:function(t){return e.$refs.imageLink.click()}}}):i("i",{staticClass:"el-icon-plus avatar-uploader-icon",on:{click:function(t){return e.$refs.imageLink.click()}}})])])],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.confirmCreateImageSource}},[e._v("确 定")])],1)],1)],1)},s=[],r=(i("cb29"),i("4de4"),i("c740"),i("4160"),i("d81d"),i("b0c0"),i("4fad"),i("c1f9"),i("d3b7"),i("25f0"),i("498a"),i("159b"),i("5530")),o=i("3835"),l=i("697e"),h=i("2dc5"),c=i("cb11"),d=i("c7a2"),u=i("d9fc"),p=i("76a5"),f=i("0da8"),g={name:"App",created:function(){console.log(l["b"]),this.imageSources=JSON.parse(localStorage.getItem("imageSources"))||[]},mounted:function(){var e=this;window.onresize=this.handleResize,this.zr=l["a"](document.querySelector(".draw-container"),{renderer:"canvas"}),this.group=new h["a"],this.zr.add(this.group),this.zr.on("mousewheel",this.throttle((function(t){var i=t.wheelDelta,a=e.group,n=a.scaleX,s=a.scaleY,r=e.zr.getWidth(),o=e.zr.getHeight();i>0?e.group.attr({scaleX:(10*n+1)/10,scaleY:(10*s+1)/10,originX:r/2,originY:o/2}):i<0&&e.group.attr({scaleX:(10*n-1)/10>.1?(10*n-1)/10:.1,scaleY:(10*s-1)/10>.1?(10*s-1)/10:.1,originX:r/2,originY:o/2})}),50)),this.zr.on("contextmenu",(function(e){e.event.preventDefault(),console.log(e)}))},data:function(){return{shapeArr:[[{shapeName:"任意线",index:1},{shapeName:"水平线",index:2},{shapeName:"竖直线",index:3}],[{shapeName:"矩形",index:4},{shapeName:"圆形",index:5},{shapeName:"文字",index:6}]],shapeLineOptions:[{label:"实线",value:null},{label:"虚线",value:[5,5]}],currentTabIndex:0,shapeIndex:0,zr:"",group:"",shape:null,shapeColor:"#000",shapeLineDash:null,shapeLineWidth:5,button:void 0,downDot:[void 0,void 0],upDot:[void 0,void 0],transitionStart:[0,0],transitionEnd:[0,0],isShapeStart:!1,isShapeEditing:!1,isShapeDone:!1,isMapMoving:!1,dialogFormVisible:!1,dialogTitle:"",imageSources:[],form:{id:"",name:"",url:""},rules:{name:[{required:!0,message:"请输入图元名称",trigger:"blur"},{min:1,max:4,message:"长度在1到4个字符",trigger:"blur"}]}}},methods:{handleTest:function(){console.log(this.zr.painter.getSvgDom())},handleDelSource:function(e){var t=e.name;e.url;this.imageSources=JSON.parse(localStorage.getItem("imageSources")).filter((function(e){return e.name!==t})),localStorage.setItem("imageSources",JSON.stringify(this.imageSources))},handleUpdateSource:function(e){var t=e.id,i=e.name,a=e.url;this.dialogTitle="修改图元",this.dialogFormVisible=!0,this.form={id:t,name:i,url:a}},reverseCoordinate:function(e){var t=Object(o["a"])(e,2),i=t[0],a=t[1],n=this.group,s=n.scaleX,r=n.scaleY,l=n.transform;return l?[(i-l[4])/s,(a-l[5])/r]:[i/s,a/r]},throttle:function(e,t){var i=!0;return function(){for(var a=this,n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];i&&(i=!1,setTimeout((function(){e.apply(a,s),i=!0}),t))}},handleResize:function(){this.zr.resize()},initDraw:function(e){var t=this,i=e.transform,a=e.children;a.forEach((function(e){var i=e.shapeIndex,a=e.shape,n=e.style,s=e.x,r=e.y,o=e.scaleX,l=e.scaleY,h=e.originX,c=e.originY,d=n.stroke,u=n.lineWidth,p=n.lineDash;if(1===i){var f=a.x1,g=a.y1,m=a.x2,v=a.y2;t.drawLine({x1:f,y1:g,x2:m,y2:v,color:d,lineWidth:u,lineDash:p})}else if(4===i){var x=a.x,b=a.y,y=a.width,w=a.height;t.drawRect({x:x,y:b,width:y,height:w,color:d,lineWidth:u,lineDash:p})}else if(5===i){var S=a.cx,C=a.cy,O=a.r;t.drawCircle({cx:S,cy:C,r:O,color:d,lineWidth:u,lineDash:p})}else if(6===i){var D=n.x,k=n.y,I=n.fill,M=n.text,j=n.fontSize;t.drawText({x:D,y:k,text:M,color:I,fontSize:j})}t.shape.attr({x:s,y:r,scaleX:o,scaleY:l,originX:h,originY:c})})),this.group.attr(Object(r["a"])({},i))},download:function(e,t){this.$refs.downloadLink.href="data:text/plain,"+encodeURIComponent(JSON.stringify(e,null,2)),this.$refs.downloadLink.download=t,this.$refs.downloadLink.click()},upload:function(){this.$refs.uploadLink.click()},handleFileChange:function(e){var t=this,i=new FileReader;i.onload=function(i){try{var a=JSON.parse(i.target.result.toString());t.initDraw(a),e.target.value=""}catch(n){console.error("文件格式错误")}},i.readAsText(e.target.files[0])},handleChooseImage:function(e){var t=this,i=new FileReader;i.onload=function(i){t.form.url=i.target.result,e.target.value=""},i.readAsDataURL(e.target.files[0])},drawShape:function(e){var t=this.shapeColor,i=this.shapeLineWidth,a=this.shapeLineDash,n=this.shapeIndex,s=this.group;s.x,s.y,s.scaleX,s.scaleY,s.originX,s.originY;if(0!==n){if(1===n){var r=e.x1,l=e.y1,h=e.x2,c=e.y2,d=this.reverseCoordinate([r,l]),u=Object(o["a"])(d,2),p=u[0],f=u[1],g=this.reverseCoordinate([h,c]),m=Object(o["a"])(g,2),v=m[0],x=m[1];return this.drawLine({x1:p,y1:f,x2:v,y2:x,color:t,lineWidth:i,lineDash:a})}if(2===n){var b=e.x1,y=e.y1,w=e.x2,S=e.y2,C=this.reverseCoordinate([b,y]),O=Object(o["a"])(C,2),D=O[0],k=O[1],I=this.reverseCoordinate([w,S]),M=Object(o["a"])(I,2),j=M[0];M[1];return this.drawLine({x1:D,y1:k,x2:j,y2:k,color:t,lineWidth:i,lineDash:a})}if(3===n){var z=e.x1,_=e.y1,L=e.x2,T=e.y2,W=this.reverseCoordinate([z,_]),X=Object(o["a"])(W,2),Y=X[0],N=X[1],F=this.reverseCoordinate([L,T]),E=Object(o["a"])(F,2),$=(E[0],E[1]);return this.drawLine({x1:Y,y1:N,x2:Y,y2:$,color:t,lineWidth:i,lineDash:a})}if(4===n){var A=e.x1,R=e.y1,J=e.x2,V=e.y2,P=this.reverseCoordinate([A,R]),q=Object(o["a"])(P,2),U=q[0],H=q[1],B=this.reverseCoordinate([J,V]),G=Object(o["a"])(B,2),K=G[0],Q=G[1];return this.drawRect({x:U,y:H,width:Math.abs(K-U),height:Math.abs(Q-H),color:t,lineWidth:i,lineDash:a})}if(5===n){var Z=e.x1,ee=e.y1,te=e.x2,ie=e.y2,ae=this.reverseCoordinate([Z,ee]),ne=Object(o["a"])(ae,2),se=ne[0],re=ne[1],oe=this.reverseCoordinate([te,ie]),le=Object(o["a"])(oe,2),he=le[0],ce=le[1];return this.drawCircle({cx:se,cy:re,r:Math.sqrt(Math.pow(he-se,2)+Math.pow(ce-re,2)),color:t,lineWidth:i,lineDash:a})}}},attrShape:function(e){var t=this.shapeIndex,i=e.x2,a=e.y2;if(1===t){var n=this.reverseCoordinate([i,a]),s=Object(o["a"])(n,2),r=s[0],l=s[1];this.shape.attr("shape",{x2:r,y2:l})}else if(2===t){var h=this.shape.shape,c=(h.x1,h.y1),d=this.reverseCoordinate([i,a]),u=Object(o["a"])(d,2),p=u[0];u[1];this.shape.attr("shape",{x2:p,y2:c})}else if(3===t){var f=this.shape.shape,g=f.x1,m=(f.y1,this.reverseCoordinate([i,a])),v=Object(o["a"])(m,2),x=(v[0],v[1]);this.shape.attr("shape",{x2:g,y2:x})}else if(4===t){var b=this.shape.shape,y=b.x,w=b.y,S=this.reverseCoordinate([i,a]),C=Object(o["a"])(S,2),O=C[0],D=C[1];this.shape.attr("shape",{width:O-y,height:D-w})}else if(5===t){var k=this.shape.shape,I=k.cx,M=k.cy,j=this.reverseCoordinate([i,a]),z=Object(o["a"])(j,2),_=z[0],L=z[1];this.shape.attr("shape",{r:Math.sqrt(Math.pow(_-I,2)+Math.pow(L-M,2))})}},translateGroup:function(e){var t=e.x,i=e.y;this.group.attr({x:t,y:i})},drawLine:function(e){var t=e.x1,i=e.y1,a=e.x2,n=e.y2,s=e.color,r=e.lineWidth,o=e.lineDash;this.shape=new c["a"]({shapeIndex:1,draggable:!0,shape:{x1:t,y1:i,x2:a,y2:n},style:{stroke:s,lineWidth:r,lineDash:o,strokeNoScale:!0}}),this.group.add(this.shape)},drawRect:function(e){var t=e.x,i=e.y,a=e.width,n=e.height,s=e.color,r=e.lineWidth,o=e.lineDash;this.shape=new d["a"]({draggable:!0,shapeIndex:4,shape:{x:t,y:i,width:a,height:n,r:r/10},style:{stroke:s,lineWidth:r,fill:"none",lineDash:o,strokeNoScale:!0}}),this.group.add(this.shape)},drawCircle:function(e){var t=e.cx,i=e.cy,a=e.r,n=e.color,s=e.lineWidth,r=e.lineDash;this.shape=new u["a"]({shapeIndex:5,draggable:!0,shape:{cx:t,cy:i,r:a},style:{fill:"none",lineWidth:s,stroke:n,lineDash:r,strokeNoScale:!0}}),this.group.add(this.shape)},drawText:function(e){var t=e.x,i=e.y,a=e.text,n=e.fontSize,s=e.color;this.shape=new p["a"]({shapeIndex:6,draggable:!0,shape:{},style:{x:t,y:i,text:a,fontSize:n,align:"center",verticalAlign:"center",fill:s}}),this.group.add(this.shape)},drawImage:function(e){var t=e.url,i=e.x,a=e.y,n=e.width,s=e.height;this.shape=new f["a"]({shapeIndex:7,draggable:!0,shape:{},style:{x:i,y:a,width:n,height:s,image:t}}),this.group.add(this.shape)},handleShowSource:function(){this.currentTabIndex=0},handleManageSource:function(){this.currentTabIndex=1},handleCreateImageSource:function(){this.dialogTitle="创建图元",this.dialogFormVisible=!0},confirmCreateImageSource:function(){var e=this.form,t=e.name,i=e.url,a=e.id;if(t&&i){if("创建图元"===this.dialogTitle){var n=this.imageSources.findIndex((function(e){return e.name===t}));if(n>-1)return this.$message.error("该图元已经存在");this.imageSources.push({id:Date.now(),name:t,url:i})}else"修改图元"===this.dialogTitle&&(this.imageSources=this.imageSources.map((function(e){return e.id===a?{id:a,name:t,url:i}:e})));this.form={id:"",name:"",url:""},this.dialogFormVisible=!1,this.dialogTitle="",localStorage.setItem("imageSources",JSON.stringify(this.imageSources))}},handleChooseShape:function(e){var t=this;this.shapeIndex===e?this.shapeIndex=0:(this.shapeIndex=e,6===e&&this.$prompt("请输入要添加的文字内容","消息",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"textarea",inputErrorMessage:"请输入正确格式的文字！",inputValidator:function(e){return!!e.trim()}}).then((function(e){var i=e.value,a=t.reverseCoordinate([t.zr.getWidth()/2,t.zr.getHeight()/2]),n=Object(o["a"])(a,2),s=n[0],r=n[1],l=t.shapeColor,h=t.shapeLineWidth;t.drawText({x:s,y:r,text:i.trim(),fontSize:h+10,color:l})})).catch((function(){t.$message({type:"info",message:"取消输入"})})).finally((function(){t.shapeIndex=0})))},handleChooseColor:function(e){this.shapeColor=e},handleChooseLineWidth:function(e){this.shapeLineWidth=e},handleOpenFile:function(){this.upload()},handleSaveFile:function(){var e={transform:{},children:[]},t=this.group,i=t.x,a=t.y,n=t.scaleX,s=t.scaleY,r=t.originX,o=t.originY;e.transform={x:i,y:a,scaleX:n,scaleY:s,originX:r,originY:o},e.children=this.group.children().map((function(e){var t=e.shape,i=e.shapeIndex,a=e.style,n=e.x,s=e.y,r=e.scaleX,o=e.scaleY,l=e.originX,h=e.originY;return{shapeIndex:i,shape:Object.fromEntries(Object.entries(t)),style:Object.fromEntries(Object.entries(a)),x:n,y:s,scaleX:r,scaleY:o,originX:l,originY:h}})),this.download(e,"shape.json")},handleClearMap:function(){this.group.removeAll(),this.zr.refresh(),this.shape=null},handleMouseDown:function(e){var t=e.button,i=e.zrX,a=e.zrY;if(this.button=t,this.isLeftDown)this.downDot=[i,a];else if(this.idMiddleDown){this.isMapMoving=!0;var n=this.group.x||0,s=this.group.y||0;this.transitionStart=[i-n,a-s]}},handleMousemove:function(e){var t=e.button,i=e.zrX,a=e.zrY;if(this.isShapeStart&&0===t)this.isShapeEditing=!0,this.attrShape({x2:i,y2:a});else if(this.idMiddleDown&&this.isMapMoving){this.isMapMoving=!0,this.transitionEnd=[i,a];var n=Object(o["a"])(this.transitionStart,2),s=n[0],r=n[1];this.translateGroup({x:i-s,y:a-r})}},handleMouseup:function(e){e.button;var t=e.zrX,i=e.zrY;if(this.isLeftDown){this.upDot=[t,i];var a=Object(o["a"])(this.downDot,2),n=a[0],s=a[1],r=Object(o["a"])(this.upDot,2),l=r[0],h=r[1];Math.abs(n-l)<=1&&Math.abs(s-h)<=1&&(this.isShapeStart=!0),this.isShapeStart&&this.isShapeEditing&&(this.isShapeStart=!1,this.isShapeEditing=!1,this.isShapeDone=!0)}else this.idMiddleDown&&this.isMapMoving&&(this.isMapMoving=!1,this.transitionEnd=[t,i])},handleContextmenu:function(){},handleAddImage:function(e){e.name;var t=e.url,i=this.reverseCoordinate([this.zr.getWidth()/2,this.zr.getHeight()/2]),a=Object(o["a"])(i,2),n=a[0],s=a[1];this.drawImage({url:t,x:n-50,y:s-50,width:100,height:100})}},computed:{isLeftDown:function(){return 0===this.button},idMiddleDown:function(){return 1===this.button},isRightDown:function(){return 2===this.button}},watch:{isShapeStart:function(e){if(e){var t=this.color,i=this.lineWidth,a=this.lineDash,n=Object(o["a"])(this.downDot,2),s=n[0],r=n[1],l=Object(o["a"])(this.upDot,2),h=l[0],c=l[1];this.drawShape({x1:s,y1:r,x2:h,y2:c,color:t,lineWidth:i,lineDash:a})}}}},m=g,v=(i("7c55"),i("2877")),x=Object(v["a"])(m,n,s,!1,null,null,null),b=x.exports,y=i("5c96"),w=i.n(y);i("0fae"),i("f5df1"),i("cd22");a["default"].use(w.a),a["default"].config.productionTip=!1,new a["default"]({render:function(e){return e(b)}}).$mount("#app")},"7c55":function(e,t,i){"use strict";i("2395")},cd22:function(e,t,i){}});
//# sourceMappingURL=app.1c7d25e2.js.map